# 微信支付配置

## 1. 申请微信支付接口
首先，前往微信商户平台申请开通微信支付功能。

## 2. 支付接口支持
插件支持以下支付接口：

- **Native支付**：用于电脑浏览器支付，微信扫码支付形式。
- **JSAPI支付**：用于微信内置浏览器支付，直接唤起微信支付。
- **H5支付**：用于手机浏览器访问支付，呼起微信客户端。

**温馨提示**：微信支付需要有已认证的微信社交载体，如服务号、媒体类订阅号或小程序，特别是当需要支持微信内置浏览器支付时，推荐使用服务号或媒体类订阅号。

## 3. 网站设置
为了避免支付回调异常，请在`设置 > 固定链接`中先设置好固定链接。
确保未禁用WordPress的REST API功能，因为Member Pro用户中心插件依赖此功能进行支付回调通知。

## 4. 插件设置
进入`WooCommerce > 设置 > 付款`，启用微信支付后，点击管理进入设置页面并按以下步骤配置：

- **APPID**：在微信支付开户邮件中可找到，或在微信商户平台查看。
- **APPSecret**：用于公众号支付，在微信公众平台（`开发 > 基本配置`）中获取。
- **商户号**：MCHID商户号，在开户邮件中可查看。
- **支付密钥**：商户支付密钥，在微信商户平台的`账户中心 > API安全`中设置。

## 5. API证书
若使用涉及资金回滚的接口（如退款），需上传API证书：

- **下载证书**：微信商户平台 > `账户中心 > API安全`。
- **上传文件**：将`apiclient_cert.pem`和`apiclient_key.pem`文件上传至网站目录`wp-content/wxpay-cert/`（如无该目录，可自行创建）。

## 6. 微信平台设置

### 微信公众号设置
- 配置业务域名、JS接口安全域名、网页授权域名：`设置与开发 > 公众号设置 > 功能设置`。
- 配置IP白名单，添加网站服务器IP地址：`设置与开发 > 基本配置`。

### 微信支付商户平台设置
配置支付接口：

- **JSAPI支付**：结账页面目录地址（默认为`/checkout/order-pay/`，若修改过结账页面链接，需使用实际链接）。
- **H5支付**：填写网站域名，区分www和非www。
- **Native支付**：填写支付回调链接（网站首页地址）。

**温馨提示**：若遇到"URL未注册"错误，检查固定链接设置中的URL结构，确保与支付配置一致。

---

# 支付宝支付配置

## 1. 接口申请
需先在支付宝商家中心申请支付接口，支持以下接口：

- **电脑网站支付**：PC端浏览器支付。
- **手机网站支付**：手机端浏览器支付。
- **当面付**：适用于个体商户，无需再申请PC或移动端支付。

## 2. 支付宝平台设置
在支付宝开放平台 > 控制台中找到已添加的应用，确保包含电脑网站支付和手机网站支付，如果需要当面付接口则需完成签约。

## 3. 插件设置
进入`WooCommerce > 设置 > 付款`，启用支付宝后，点击管理进入设置页面并配置：

- **APPID**：在支付宝开放平台中找到。
- **应用私钥**：需要自己生成，生成后填入应用私钥框，公钥需填写到支付宝开放平台应用中。
- **支付宝公钥**：在支付宝开放平台应用信息中找到。

## 4. 加密模式设置
若首次设置，选择加密模式为公钥模式。生成的应用公钥需添加到公钥字符选项中。

**温馨提示**：支付宝的授权回调地址请留空，以避免回调验证失败。

---

# 其他注意事项

## 回调设置
确保所有支付接口的回调地址配置正确，并根据实际情况调整为HTTPS协议。

## 支付接口与固定链接设置
如果遇到支付回调失败的问题，请检查固定链接设置是否符合要求，确保URL结构正确。

## REST API功能
支付回调依赖REST API功能，确保没有禁用此功能。
